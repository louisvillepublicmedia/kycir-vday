<!doctype html>
<html lang='en-GB'>
<head>
  <link rel="stylesheet" href="css/style.css">
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="fb:app_id" content="169481433545731" />
  <meta property="og:url" content="http://interactives.kycir.org/vday/play.html" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Operation Spread Love, Not Twitter Hate" />
  <meta property="og:description" content="Help us spread the love this Valentine's Day by flipping the script on some political tweets." />
  <meta property="og:image" content="http://interactives.kycir.org/vday/img/vday-play.jpg" />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@KentuckyCIR">
  <meta name="twitter:creator" content="@act_rational">
  <meta name="twitter:title" content="Operation Spread Love, Not Twitter Hate">
  <meta name="twitter:description" content="Help us spread the love this Valentine's Day by flipping the script on some political tweets.">
  <meta name="twitter:image" content="http://interactives.kycir.org/vday/img/vday-play.jpg">
  <title>Operation Spread Love, Not Twitter Hate</title>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-32037403-7', 'auto');
    ga('send', 'pageview');
  
  </script>
</head>

<body>
  <div id="fb-root"></div>
  <script>
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=169481433545731";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    
    window.twttr = (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
      if (d.getElementById(id)) return t;
      js = d.createElement(s);
      js.id = id;
      js.src = "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);
    
      t._e = [];
      t.ready = function(f) {
        t._e.push(f);
      };
    
      return t;
    }(document, "script", "twitter-wjs"));
  </script>
  
  <div id="header" class="row">
    <div class="option col-6">
      <h1>Operation Spread Love, Not Twitter Hate</h1>
    </div>
    <div id="menu" class="option col-3">
      <ul>
        <li><a class="active" href="#choose-card">Play</a></li>
        <li><a href="results.html">Results</a></li>
      </ul>
    </div>
    <div id="social" class="option col-3">
      <ul>
        <li class="fb-share-button" data-href="http://interactives.kycir.org/vday/play.html" data-layout="button" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Finteractives.kycir.org%2Fvday%2Fplay.html&amp;src=sdkpreparse">Share</a></li>
        <li><a class="twitter-share-button" data-size="large" href="https://twitter.com/intent/tweet">Tweet</a></li>
      </ul>
    </div>
  </div>
  <div class="lead">
    <p>Here’s how it works:</p>
    <ol>
      <li>Pick a politico.</li>
      <li>Complete the statement provided. Be nice, keep it clean.<br> Valentine’s Day is a time to show you care.</li>
      <li>Follow the link to send, share and admire!</li>
    </ol>
  </div>
  <div id="container" class="container-fluid"></div>
  
  <div id="footer" class="row">
    <div class="col-3">
      <a href="http://kycir.org"><img src="img/kycir-logo.png" alt="kycir logo" /></a>
    </div>
    <div class="col-7">
      <p><em><strong>Operation Spread Love, Not Twitter Hate</strong> is brought to you by the Kentucky Center for Investigative Reporting. To see more of our work, visit <a href="http://kycir.org">kycir.org</a>.</em></p>
      <p><em>If you are experiencing issues with this app, please contact Alexandra Kanik at akanik@kycir.org.</em></p>
    </div>
  </div>

  <script id='template' type='text/ractive'>
    
    <div id="choose-card" class="row">
      <p class="step-text">1. Choose a Kentucky politician:</p>
      {{#each cards}}
        <div class="col-2 card">
          <img on-click='activate' src="{{image}}" alt="{{name}}" />
          <h3>{{name}}</h3>
          <h4>{{title}}</h4>
        </div>
      {{/each}}
    </div>
    
    {{#if currentCard}}
    <div id="mad-lib" class="row">
      <img src="{{currentCard.image}}" alt="{{name}}" />
      <p class="step-text blocktext">2. Help {{currentCard.name}} spread the love this Valentine's Day:</p>
      <p id="quote" class="blocktext">{{{madLib}}}</p>
      <p class="blocktext"><a href="#" class="myButton" on-click='submit'>Submit</a></p>
    </div>
    {{/if}}
    
    {{#if completedMadLib}}
    <div id="share" class="row">
      <div id="real-quote" class="center">
        <h3>Here's what {{currentCard.name}} actually said:</h3>
        <p><em>{{realQuote}}</em></p>
        <p><a href="{{quoteSource}}" target="_blank">See for yourself >></a></p>
      </div>
      
      <p class="step-text">3. Share your valentine with the world:</p>
      <p class="center"><span class="selectAll" contenteditable="true">{{shareURL}}</span></p>
      <p class="blocktext center"><a href="{{shareURL}}" target="_blank" class="shareButton">Share</a></p>
      <canvas style="display:none;" id="card-canvas" width="750" height="370"></canvas>
      <img src="http://interactives.kycir.org/vday{{madLibURL}}" alt="your completed valentine" />
    </div>
    {{/if}}
  </script>

  <script src='scripts/js/ractive.min.js'></script>
  <script src='scripts/js/jquery-3.1.1.min.js'></script>
  <script src='scripts/js/jquery.profanityfilter-v2.js'></script>
  
  <script>
        
    //This function wraps the text on the canvas. By default, canvas
    // fillText does not wrap.
    // http://www.html5canvastutorials.com/tutorials/html5-canvas-wrap-text-tutorial/
    function wrapText(context, text, x, y, maxWidth, lineHeight) {
      var words = text.split(' ');
      var line = '';

      for(var n = 0; n < words.length; n++) {
        var testLine = line + words[n] + ' ';
        var metrics = context.measureText(testLine);
        var testWidth = metrics.width;
        if (testWidth > maxWidth && n > 0) {
          context.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        }
        else {
          line = testLine;
        }
      }
      context.fillText(line, x, y);
    }
    
    var ractive, cards, quotes;
    
    cards = [{"characterUID": "1", "name": "Mitch McConnell", "title": "U.S. Senator", "image": "img/characters/character-mcconnell.jpg", "card": "img/cards/card-mcconnell.jpg"}, {"characterUID": "2", "name": "Rand Paul", "title": "U.S. Senator", "image": "img/characters/character-paul.jpg", "card": "img/cards/card-paul.jpg"}, {"characterUID": "3", "name": "Matt Bevin", "title": "Governor", "image": "img/characters/character-bevin.jpg", "card": "img/cards/card-bevin.jpg"}, {"characterUID": "4", "name": "Andy Beshear", "title": "Attorney General", "image": "img/characters/character-abeshear.jpg", "card": "img/cards/card-abeshear.jpg"}, {"characterUID": "5", "name": "Steve Beshear", "title": "Former Governor", "image": "img/characters/character-sbeshear.jpg", "card": "img/cards/card-sbeshear.jpg"}, {"characterUID": "6", "name": "Greg Stumbo", "title": "Former Speaker of the House", "image": "img/characters/character-stumbo.jpg", "card": "img/cards/card-stumbo.jpg"}, {"characterUID": "7", "name": "Robert Stivers", "title": "Senate President", "image": "img/characters/character-stivers.jpg", "card": "img/cards/card-stivers.jpg"}, {"characterUID": "8", "name": "Alison Lundergan Grimes", "title": "Secretary of State", "image": "img/characters/character-grimes.jpg", "card": "img/cards/card-grimes.jpg"}, {"characterUID": "9", "name": "Jeff Hoover", "title": "Speaker of the House", "image": "img/characters/character-hoover.jpg", "card": "img/cards/card-hoover.jpg"}];
    
    quotes = [{"quoteUID": "1", "characterName": "Mitch McConnell", "characterUID": "1", "quote": "It's time for #Democrats to understand what consumers already know:  #Obamacare is unraveling.", "mad_lib": "It’s time for *** to understand what *** already knows. Valentine’s Day is about love and understanding.", "source_link": "https://twitter.com/SenateMajLdr/status/773930862350102533", "source": "twitter"}, {"quoteUID": "2", "characterName": "Mitch McConnell", "characterUID": "1", "quote": "Thanks to extreme Democratic obstruction, @POTUS has fewer cabinet officials confirmed at this point than any point in modern history", "mad_lib": "“Thanks to extreme ***, *** has my adoration. Happy Valentine’s!”", "source_link": "https://twitter.com/SenateMajLdr/status/828699133124935680", "source": "twitter"}, {"quoteUID": "3", "characterName": "Rand Paul", "characterUID": "2", "quote": "Protecting the entire Bill of Rights is one of the main reasons I ran for office. I'll remain vigilant in that cause", "mad_lib": "*** is one of the main reasons I ***. I’ll remain vigilant on Valentine’s Day.", "source_link": "https://twitter.com/RandPaul/status/823688092028719112", "source": "twitter"}, {"quoteUID": "4", "characterName": "Rand Paul", "characterUID": "2", "quote": "I remember a time when Republicans actually said we should reduce the size and scope of government…", "mad_lib": "I remember a time when *** actually said we should ***. Happy Valentine’s!!", "source_link": "https://twitter.com/RandPaul/status/818586079485956097", "source": "twitter"}, {"quoteUID": "5", "characterName": "Matt Bevin", "characterUID": "3", "quote": "I have no respect for people who lie for personal or political gain. Russ Meyer is such a person.", "mad_lib": "Happy Valentine’s! I have *** for people who ***. *** is such a person!", "source_link": "https://www.facebook.com/mattbevinforkentucky/posts/1125499390899704:0", "source": "facebook"}, {"quoteUID": "6", "characterName": "Matt Bevin", "characterUID": "3", "quote": "One thing he does know is how to get angry, white men to vote for him\" says angry white man, @billclinton about @realDonaldTrump...Hmmmm… ", "mad_lib": "One thing *** does know is how to ***. Happy Valentine’s!", "source_link": "https://twitter.com/MattBevin/status/811412557445693440", "source": "twitter"}, {"quoteUID": "7", "characterName": "Andy Beshear", "characterUID": "4", "quote": "I would suggest in the future that if the governor has any questions on the hard work of my office that he walk across the hallway and ask to meet with me, and not hide behind Facebook.", "mad_lib": "For Valentine’s Day, I would suggest that *** walk across the hallway and ***, with love.", "source_link": "http://www.courier-journal.com/story/news/politics/2017/01/25/bevin-beshear-wont-defend-ultrasound-law/97038266/", "source": "web"}, {"quoteUID": "8", "characterName": "Steve Beshear", "characterUID": "5", "quote": "At some point, Matt Bevin has to realize there is a time to campaign and a time to govern. Attacking me in an effort to distract the public from his Benefind debacle and his plan to strip away healthcare from hundreds of thousands of Kentuckians will not work. Today's accusations, which have absolutely no basis in truth, continue this pathetic spectacle. There was never any attempt to pressure employees to make political contributions, and we followed both the spirit and the letter of procurement laws. Furthermore, I made my tax returns public all eight years I was governor, something Gov. Bevin refuses to do even after promising to do so. Kentuckians deserve better.", "mad_lib": "At some point, *** has to realize there is a time to *** and a time to *** on Valentine’s Day.", "source_link": "https://www.facebook.com/govstevebeshear/posts/10154252607582590", "source": "facebook"}, {"quoteUID": "9", "characterName": "Steve Beshear", "characterUID": "5", "quote": "Takeaway from all this: Ky families need more governing and less campaigning. Because there's a huge difference.", "mad_lib": "Takeaway from all this: *** needs more ***. Happy Valentine's Day!", "source_link": "https://twitter.com/Steve__Beshear/status/725425114175643648", "source": "twitter"}, {"quoteUID": "10", "characterName": "Greg Stumbo", "characterUID": "6", "quote": "Simple question @GovMattBevin - did you or did you not meet with Rep Sinnette & others in the the Gov's mansion 2 intimidate them?", "mad_lib": "Simple question *** -- did you or did you not *** on Valentine’s Day?", "source_link": "https://twitter.com/SpeakerStumbo/status/770734925502877696", "source": "twitter"}, {"quoteUID": "11", "characterName": "Robert Stivers", "characterUID": "7", "quote": "Politics are over now it is time 4 policy discussions. Already discussions w Leader Hoover & Gov Bevin & staff! Ds have reached out as well", "mad_lib": "Happy Valentine's Day. Politics are over now it is time 4 ***. ", "source_link": "https://twitter.com/kysenatepres/status/796692002154971140", "source": "twitter"}, {"quoteUID": "12", "characterName": "Robert Stivers", "characterUID": "7", "quote": "Ted Cruze said he treats people w respect & dignity! Was it respectful & dignified 2 call Sen McConnell a liar on the US Senate floor!", "mad_lib": "*** treats people with respect & dignity on Valentine’s Day!", "source_link": "https://twitter.com/kysenatepres/status/756123873565892612", "source": "twitter"}, {"quoteUID": "13", "characterName": "Alison Lundergan Grimes", "characterUID": "8", "quote": "He says he's never wrong. He is never sorry. He is never responsible. Let's make sure @realDonaldTrump is never our President.", "mad_lib": "Let’s make sure *** is *** on Valentine’s Day!", "source_link": "https://twitter.com/AlisonForKY/status/788923056639078400", "source": "twitter"}, {"quoteUID": "14", "characterName": "Alison Lundergan Grimes", "characterUID": "8", "quote": "Dear @realDonaldTrump, you're not fooling anyone. You do not represent us.", "mad_lib": "Dear ***. You’re not fooling anyone. You ***. Happy Valentine’s!", "source_link": "https://twitter.com/AlisonForKY/status/755929148686798848", "source": "twitter"}, {"quoteUID": "15", "characterName": "Jeff Hoover", "characterUID": "9", "quote": "If we had more Jeff Sessions in the world we'd be a lot better off. I expect he'll help keep American and Kentucky safe from harm!", "mad_lib": "If we had more *** in the world, we’d be a lot better off. Happy Valentine’s Day!", "source_link": "https://twitter.com/speakerhoover/status/818862466692157440", "source": "twitter"}, {"quoteUID": "16", "characterName": "Jeff Hoover", "characterUID": "9", "quote": "Read @MattBevin budget. He is one of us. We will ride to Vallhalla together. #kyga16 @KYGOP", "mad_lib": "*** is one of us. We will *** together. Happy Valentine’s!", "source_link": "https://twitter.com/speakerhoover/status/693872380578500608", "source": "twitter"}];
    
    ractive = new Ractive({
      el: '#container',
      template: '#template',
      data: { 
        cards: cards,
        editme: 'blank'
      }
    });
        
    ractive.on('activate', function(event){
      ractive.set('currentCard', event.context);
      
      ractive.observe('currentCard', function(newValue, oldValue, keypath){
        if(newValue){
          //Create an array for quote available to the selected card
          var possibleQuotes = []
          
          for(var i = 0; i < quotes.length; i++){
            var quoteCharID = quotes[i]['characterUID'];
            var charID = newValue.characterUID;
            
            //If the characterID of the quote matches the characterID 
            //of the chosed card, add the quote to possibleQuotes array.
            if(charID == quoteCharID){
              possibleQuotes.push(quotes[i])
            }
          }
          
          //Randomly choose a quote from the array of possibleQuotes
          var randoQuote = possibleQuotes[Math.floor(Math.random() * possibleQuotes.length)];
          var madLib = randoQuote.mad_lib;
          
          //Split the madLib versio of the quote by those three asktrisks
          //then join it together with editable spans
          var editableMadLib = madLib.split("***").join('<span on-click="activateEdit" class="fill-in" contenteditable="true" style="display:inline-block; min-width:75px;" value="{{editme}}">Edit this</span>');
                    
          ractive.set('realQuote', randoQuote.quote);
          ractive.set('quoteSource', randoQuote.source_link);
          ractive.set('madLib', editableMadLib);
          ractive.set('card', newValue.card);
          
        }
      });
      
      //Empty the contenteditable spans when the user clicks. This is
      // particularly useful for mobile.
      // http://stackoverflow.com/questions/9093424/placeholder-in-contenteditable-focus-event-issue
      $('span.fill-in').on('activateEdit', function() {
        $(this).empty();
        var range, sel;
        if ( (sel = document.selection) && document.body.createTextRange) {
          range = document.body.createTextRange();
          range.moveToElementText(this);
          range.select();
        }
      });
      $('span.fill-in').focus(function() {
        if (this.hasChildNodes() && document.createRange && window.getSelection) {
          $(this).empty();
          var range = document.createRange();
          range.selectNodeContents(this);
          var sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
      });
            
      //Scroll down to the madLib section once we've set the scene
      $('html, body').animate({
        scrollTop: $("#mad-lib").offset().top
      }, 1000);
      
    });
    
    
    ractive.on('submit', function(event){
      
      //Grab the submitted text from the #quote element
      var completedMadLib = $('#quote').text();
      var profaneText = '';
      var card = ractive.get('card');
      
      //Filter for bad words. If bad words are detected set variable
      // to Yes and throw and alert.
      $('#quote').profanityFilter({
        externalSwears: 'data/allSwears-20170213.json',
        profaneText: function(data){
          alert("Uh oh! Our profanity filter picked up something in your submission. Make sure to fill out all the fields to complete a positive message! If you think our filter is wrong, feel free to get in touch with Alexandra Kanik at akanik@kycir.org");
          profaneText = 'Yes';
        }
      });
      
      //If that bad words variable is set to Yes, don't allow
      // the user to continue. Toss them back to madLibs section.
      //If no bad words, continue on.
      if(profaneText == 'Yes'){
        $('html, body').animate({
          scrollTop: $("#mad-lib").offset().top
        }, 1000);
      }else{
        ractive.set('completedMadLib', completedMadLib);
                
        //Establish what to put on the canvas
        var canvas = document.getElementById("card-canvas");
        var context = canvas.getContext("2d");
        var imageObj = new Image();
        var img = new Image();
        imageObj.src = card;
        imageObj.onload = function(){
          
          context.drawImage(imageObj, 10, 10);
          context.font = "35px Helvetica";
          var maxWidth = 350;
          var lineHeight = 40;
          var x = 375;
          var y = 60;
          var text = completedMadLib;
          
          wrapText(context, text, x, y, maxWidth, lineHeight);
          
          //Turn the canvas into an image and send to the server with the
          //ajax command. The return from .done() is the completed image url
          var dataURL = canvas.toDataURL();
          
          $.ajax({
            type: 'POST',
            url: 'scripts/image-save.php',
            data:{
              imgBase64: dataURL
            }
          }).done(function(o){
            var imageURL = o.replace('..','');
            var imageID = o.split('/').slice(1)[1].replace('.png','');
            var shareURL = 'http://interactives.kycir.org/vday/results.html#' + imageID;
            console.log(imageURL);
            ractive.set('madLibURL', imageURL);
            ractive.set('shareURL', shareURL);
          });
        };
                
        //Scroll down to the share section once we've set the scene.
        $('html, body').animate({
          scrollTop: $("#share").offset().top
        }, 1000);
      }
    })
    
  </script>
</body>
</html>